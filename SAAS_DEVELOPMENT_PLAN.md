# SaaS 고도화 및 구독형 모델 전환 개발 계획

## 1. 개요
현재 단일 기업용으로 개발된 `wow3d-stock-sales-manager`를 다수의 기업이 사용할 수 있는 멀티테넌트(Multi-tenant) SaaS 플랫폼으로 전환하고, 구독 기반의 수익 모델을 도입하기 위한 기술적/기능적 로드맵입니다.

## 2. 핵심 목표
1.  **멀티테넌시(Multi-tenancy) 구현**: 하나의 인스턴스에서 여러 기업(Tenant)의 데이터를 안전하게 격리하여 처리.
2.  **구독 결제 시스템 도입**: 요금제(Free, Basic, Pro)에 따른 기능 제한 및 정기 결제 구현.
3.  **사용자 및 조직 관리**: 기업별 관리자, 직원 계정 관리 및 권한 제어.

---

## 3. 단계별 개발 계획

### Phase 1: 데이터베이스 및 아키텍처 설계 (기반 공사)
가장 중요하고 위험도가 높은 단계입니다. 모든 데이터에 '소유자(기업)' 개념을 도입해야 합니다.

*   **테넌트(Tenant) 모델 정의**:
    *   `tenants` 테이블 생성 (id, name, plan_type, status, created_at 등).
    *   `users` 테이블에 `tenant_id` 외래키 추가 (사용자가 어느 기업에 속하는지).
*   **데이터 격리 적용**:
    *   기존 모든 주요 테이블(`products`, `customers`, `sales`, `stock_movements`, `outbound_orders` 등)에 `tenant_id` 컬럼 추가.
    *   **마이그레이션 전략**: 기존 데이터는 'Default Tenant'로 할당하여 보존.
*   **API 미들웨어 수정**:
    *   모든 API 요청 시 인증 토큰에서 `tenant_id`를 추출.
    *   DB 쿼리 실행 시 반드시 `WHERE tenant_id = ?`를 강제하는 로직 구현 (보안 필수).

### Phase 2: 인증 및 조직 관리 (Onboarding)
사용자가 서비스에 가입하고 조직을 생성하는 흐름을 만듭니다.

*   **회원가입/로그인 고도화**:
    *   이메일/비밀번호 또는 소셜 로그인.
    *   회원가입 시 '새 조직 생성' 또는 '기존 조직 합류(초대)' 선택.
*   **조직 관리 기능**:
    *   조직 정보 수정.
    *   직원 초대 (이메일 발송) 및 멤버 관리.
    *   권한 관리 (RBAC): 소유자(Owner), 관리자(Admin), 일반(User) 등 역할 구분.

### Phase 3: 구독 및 결제 시스템 (Billing)
수익화를 위한 결제 모듈을 연동합니다.

*   **요금제 설계**:
    *   **Free**: 상품 수 100개 제한, 사용자 1명.
    *   **Basic**: 상품 수 무제한, 사용자 5명, 기본 리포트.
    *   **Pro**: 무제한, 고급 리포트, API 연동 지원 등.
*   **결제 PG사 연동**:
    *   글로벌: Stripe (구독 관리가 매우 용이).
    *   국내: PortOne (아임포트) - 토스페이먼츠, 카카오페이 등 연동.
*   **구독 수명주기 관리**:
    *   결제 성공/실패 처리 (Webhook).
    *   구독 갱신, 업그레이드/다운그레이드, 해지 처리.
    *   요금제에 따른 기능 제한 로직 구현 (예: 상품 등록 시 현재 개수 체크).

### Phase 4: 프론트엔드 및 UX 개편
SaaS에 맞는 UI/UX로 변경합니다.

*   **랜딩 페이지**: 서비스 소개, 요금제 비교, 가입 유도 페이지.
*   **대시보드 개인화**: 로그인한 사용자의 조직 데이터만 표시.
*   **관리자(Super Admin) 페이지**:
    *   전체 테넌트 현황 조회.
    *   매출 통계.
    *   특정 테넌트 제어(정지, 삭제).

### Phase 5: 안정화 및 보안 강화
*   **데이터 백업**: 테넌트별 데이터 백업 정책.
*   **보안 감사**: 데이터 유출 방지 테스트 (타 테넌트 데이터 접근 시도 차단).
*   **성능 최적화**: 인덱싱 최적화 (`tenant_id`가 포함된 복합 인덱스).

---

## 4. 기술 스택 제안 (변경 사항)

*   **Backend**: Hono (유지) + **Middleware for Multi-tenancy**.
*   **Database**: Cloudflare D1 (유지) - Row Level Security 패턴 적용.
*   **Auth**: 직접 구현보다는 **Clerk**나 **Supabase Auth** 같은 관리형 인증 서비스 도입 권장 (개발 속도 및 보안 향상).
*   **Payment**: **PortOne V2** (국내 결제 환경 고려 시).

## 5. 예상 일정 (총 8주)
*   1-2주차: DB 스키마 변경 및 멀티테넌트 미들웨어 구현.
*   3-4주차: 회원가입, 조직 생성, 멤버 초대 기능.
*   5-6주차: 결제 연동 및 구독 관리.
*   7주차: 프론트엔드 연동 및 랜딩 페이지.
*   8주차: 테스트 및 버그 수정.
