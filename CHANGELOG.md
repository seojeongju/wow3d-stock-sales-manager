# 변경 이력 (Changelog)

## [2025-12-23] - 출고 관리 고도화 및 배송 추적 기능

### ✨ 새로운 기능

#### 1. 엑셀 일괄 출고 등록
- **기능**: 쇼핑몰 주문을 엑셀로 한 번에 등록
- **위치**: 출고 관리 > 간편 출고 등록 > [엑셀 일괄 등록] 버튼
- **사용법**:
  1. 템플릿 다운로드
  2. 엑셀에 주문 정보 입력 (상품명, 수량, 수령인, 연락처, 주소 등)
  3. 파일 업로드
  4. 자동으로 "출고 대기(PENDING)" 상태로 등록됨
- **효과**: 수십~수백 건의 주문을 수작업 없이 빠르게 등록 가능

#### 2. 출고 확정 (재고 차감)
- **기능**: 출고 대기 중인 주문을 확정하여 재고 차감
- **위치**: 출고 이력 조회 > 상세보기 > [출고 확정] 버튼 (PENDING 상태인 경우만 표시)
- **프로세스**:
  1. 출고 창고 선택
  2. 전체 재고 및 창고별 재고 검증
  3. 재고 차감 및 재고 이동 내역 기록
  4. 상태를 "출고 완료(SHIPPED)"로 변경
- **효과**: 재고 관리 정확성 향상, 출고 프로세스 체계화

#### 3. 운송장 추적 기능
- **기능**: 운송장 번호 클릭 시 택배사 배송 조회 페이지로 자동 연결
- **적용 위치**:
  - 출고 관리 > 출고 이력 조회 (운송장 컬럼)
  - 판매 관리 > 주문/배송 관리 (운송장 컬럼)
- **지원 택배사**:
  - CJ대한통운
  - 로젠택배
  - 우체국택배
  - 한진택배
  - 롯데택배
- **효과**: 배송 현황을 즉시 확인 가능, 고객 응대 시간 단축

#### 4. 직접수령 기능 개선
- **변경사항**: 택배사 선택 드롭다운에 "직접수령" 옵션 추가
- **동작**: 
  - "직접수령" 선택 시 자동으로 운송장 번호 입력란에 "직접수령" 표시
  - 체크박스와 드롭다운 양방향 동기화
- **효과**: 사용자 편의성 향상

### 🔄 개선사항

#### 출고 관리 ↔ 판매 관리 완전 연동
- **현황**: 출고 관리에서 등록한 주문이 판매 관리에 자동 반영
- **데이터 연동**:
  - 고객 정보 자동 생성/조회
  - 판매 내역 자동 기록
  - 택배사 및 운송장 번호 동기화
  - 출고 창고 정보 연동
- **배송 모달**: 판매 관리 > 배송 정보 관리 모달을 열면 출고 관리에서 입력한 정보가 자동으로 채워짐

### 🛠 기술적 변경사항

#### Backend (TypeScript)
- `src/routes/outbound.ts`:
  - `POST /api/outbound/bulk`: 엑셀 업로드용 벌크 등록 API
  - `POST /api/outbound/:id/ship`: 출고 확정 및 재고 차감 API
- `src/routes/sales.ts`:
  - `GET /api/sales/:id`: outbound_packages, outbound_orders 조인하여 배송 정보 포함
- `src/index.tsx`:
  - XLSX 라이브러리 CDN 추가

#### Frontend (JavaScript)
- `public/static/js/outbound.js`:
  - `openOutboundExcelUploadModal()`: 엑셀 업로드 모달
  - `downloadOutboundTemplate()`: 템플릿 다운로드
  - `handleExcelFileSelect()`: 엑셀 파싱 및 업로드
  - `openShipOutboundModal()`: 출고 확정 모달
  - `confirmShipOutbound()`: 출고 확정 API 호출
  - `getTrackingUrl()`: 운송장 추적 URL 생성 (→ utils.js로 이동)
- `public/static/js/utils.js`:
  - `getTrackingUrl()`: 택배사별 배송 조회 URL 생성 함수
- `public/static/app.js`:
  - 판매 관리 목록에서 운송장 번호 클릭 가능하도록 렌더링 로직 수정

### 📊 데이터베이스 스키마
- 기존 스키마 활용 (변경 없음):
  - `outbound_orders`: 출고 주문
  - `outbound_items`: 출고 상품
  - `outbound_packages`: 운송장 정보
  - `outbound_order_mappings`: 판매-출고 매핑
  - `sales`, `sale_items`: 판매 기록
  - `customers`: 고객 정보
  - `stock_movements`: 재고 이동 내역

### 🎯 다음 개선 예정 사항

#### 우선순위 높음
- [ ] 스위트트래커(SweetTracker) API 연동
  - 배송 상태 자동 업데이트
  - "배송 완료" 자동 감지
  - 구매 확정 자동화

#### 우선순위 중간
- [ ] 재고 부족 알림 시스템
- [ ] 대시보드 통계 개선 (출고 현황 차트)
- [ ] 모바일 UI 최적화
- [ ] 엑셀 업로드 시 SKU 기반 상품 매칭

#### 우선순위 낮음
- [ ] 출고 라벨 프린트 기능
- [ ] 피킹 리스트 생성
- [ ] 배송 지연 알림

---

## 이전 변경 이력

### [2025-12-22] - 직접수령 기능 추가
- 택배사 선택에 "직접수령" 옵션 추가
- 체크박스와 드롭다운 양방향 동기화

### [2025-12-21] - 기본 출고 관리 시스템 구축
- 간편 출고 등록 기능
- 출고 이력 조회 및 상세보기
- 창고별 재고 관리
